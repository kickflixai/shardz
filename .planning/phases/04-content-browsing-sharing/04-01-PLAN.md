---
phase: 04-content-browsing-sharing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(browse)/browse/page.tsx
  - src/app/(browse)/browse/genre-filter.tsx
  - src/components/series/series-card.tsx
  - src/components/series/series-grid.tsx
  - src/config/genres.ts
  - src/modules/content/queries/get-series-by-genre.ts
  - src/modules/content/types.ts
  - src/app/layout.tsx
  - src/components/ui/badge.tsx
  - src/components/ui/skeleton.tsx
  - src/components/ui/aspect-ratio.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a grid of series cards organized by genre on the browse page"
    - "User can click genre filter pills to filter series by category (Drama, Comedy, Thriller, Sci-Fi, Horror, Romance, Action, Documentary, BTS, Music, Sports)"
    - "Genre filter state is stored in the URL query param (?genre=thriller) so filtered views are shareable"
    - "Series cards display thumbnail, title, genre badge, episode count, and creator name"
  artifacts:
    - path: "src/config/genres.ts"
      provides: "Single source of truth for genre enum display names"
      contains: "GENRE_CONFIG"
    - path: "src/app/(browse)/browse/page.tsx"
      provides: "Genre-filtered browse page as Server Component"
      contains: "searchParams"
    - path: "src/app/(browse)/browse/genre-filter.tsx"
      provides: "Client Component genre filter using nuqs"
      contains: "useQueryState"
    - path: "src/components/series/series-card.tsx"
      provides: "Series card component with thumbnail, title, genre, episode count, creator"
      contains: "SeriesCard"
    - path: "src/components/series/series-grid.tsx"
      provides: "Responsive grid layout for series cards"
      contains: "SeriesGrid"
    - path: "src/modules/content/queries/get-series-by-genre.ts"
      provides: "Supabase query for published series filtered by genre"
      contains: "getSeriesByGenre"
    - path: "src/modules/content/types.ts"
      provides: "Composite types for series with creator and episode count"
      contains: "SeriesWithCreator"
  key_links:
    - from: "src/app/(browse)/browse/page.tsx"
      to: "src/modules/content/queries/get-series-by-genre.ts"
      via: "Server Component calls getSeriesByGenre with genre from searchParams"
      pattern: "getSeriesByGenre"
    - from: "src/app/(browse)/browse/genre-filter.tsx"
      to: "nuqs"
      via: "useQueryState updates URL ?genre= param, triggers server re-render"
      pattern: "useQueryState"
    - from: "src/components/series/series-card.tsx"
      to: "src/config/genres.ts"
      via: "Import getGenreLabel for genre badge display"
      pattern: "getGenreLabel"
---

<objective>
Build the genre-based browse page with series card components, genre filter bar using nuqs for URL-based state, and Supabase data queries for published series.

Purpose: Enables content discovery -- users can browse all published series and filter by genre category. The URL-based filter makes filtered views shareable and bookmarkable.
Output: Functional browse page at /browse showing series cards with genre filtering.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-content-browsing-sharing/04-RESEARCH.md

# Current files to modify
@src/app/(browse)/browse/page.tsx
@src/app/layout.tsx
@src/db/types.ts
@src/config/env.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, add shadcn components, create genre config and data query layer</name>
  <files>
    src/config/genres.ts
    src/modules/content/types.ts
    src/modules/content/queries/get-series-by-genre.ts
    src/components/ui/badge.tsx
    src/components/ui/skeleton.tsx
    src/components/ui/aspect-ratio.tsx
    src/app/layout.tsx
  </files>
  <action>
    1. Install nuqs for URL query state: `pnpm add nuqs`
    2. Add shadcn components: `pnpm dlx shadcn@latest add badge skeleton aspect-ratio`
    3. Create `src/config/genres.ts` -- single source of truth for genre display names:
       - Export `GENRE_CONFIG: Record<Genre, { label: string }>` mapping all 11 genres from the Genre type in `src/db/types.ts` to their display labels (drama -> "Drama", behind-the-scenes -> "BTS", sci-fi -> "Sci-Fi", etc.)
       - Export `ALL_GENRES = Object.keys(GENRE_CONFIG) as Genre[]`
       - Export `getGenreLabel(genre: Genre): string` helper function
    4. Create `src/modules/content/types.ts` -- composite types for browse/detail views:
       - `SeriesWithCreator`: Series fields (id, slug, title, genre, thumbnail_url, view_count, status) plus nested `creator: { display_name: string }` and `episode_count: number`
       - These types match the shape returned by Supabase queries with joins
    5. Create `src/modules/content/queries/get-series-by-genre.ts`:
       - Export `getSeriesByGenre(genre?: string)` async function
       - Uses `createClient()` from `@/lib/supabase/server`
       - Queries `series` table with select: `id, slug, title, genre, thumbnail_url, view_count, status, profiles!inner(display_name), seasons(id, episodes(id))`
       - Filters by `.eq("status", "published")`
       - If genre is provided and not "all", adds `.eq("genre", genre)`
       - Orders by `created_at` descending
       - Returns the data array (or empty array on error)
       - Maps the raw Supabase response to flatten the episode count (count seasons[].episodes[] to get total episode count per series)
    6. Update `src/app/layout.tsx`:
       - Add `import { NuqsAdapter } from "nuqs/adapters/next/app"`
       - Wrap `{children}` with `<NuqsAdapter>{children}</NuqsAdapter>` INSIDE the existing provider chain (inside SerwistProvider)
       - Preserve all existing providers (ThemeProvider, SerwistProvider) and their ordering
  </action>
  <verify>
    - `pnpm build` passes with no TypeScript errors
    - `src/config/genres.ts` exports GENRE_CONFIG with all 11 genres
    - `src/modules/content/queries/get-series-by-genre.ts` exports getSeriesByGenre
    - `src/components/ui/badge.tsx`, `skeleton.tsx`, `aspect-ratio.tsx` exist
    - NuqsAdapter wraps children in root layout
  </verify>
  <done>Genre config, composite types, data query, and UI components are in place. NuqsAdapter is wired into the root layout for URL state management.</done>
</task>

<task type="auto">
  <name>Task 2: Build genre filter bar, series card, series grid, and wire up the browse page</name>
  <files>
    src/app/(browse)/browse/genre-filter.tsx
    src/components/series/series-card.tsx
    src/components/series/series-grid.tsx
    src/app/(browse)/browse/page.tsx
  </files>
  <action>
    1. Create `src/app/(browse)/browse/genre-filter.tsx` (Client Component):
       - `"use client"` directive
       - Import `useQueryState`, `parseAsString` from `nuqs`
       - Import `GENRE_CONFIG`, `ALL_GENRES` from `@/config/genres`
       - Render a horizontal scrollable flex row of genre pills/buttons
       - Include an "All" button at the start (value "all", clears the genre param when selected)
       - Active genre gets primary styling (bg-primary text-primary-foreground), inactive gets muted outline styling
       - Use `setGenre(value === "all" ? null : value)` to clear the param for "all"
       - Use `history: "push"` option for nuqs so browser back button works with genre changes
    2. Create `src/components/series/series-card.tsx`:
       - Import `SeriesWithCreator` from `@/modules/content/types`
       - Import `Badge` from `@/components/ui/badge`
       - Import `getGenreLabel` from `@/config/genres`
       - Import `Link` from `next/link`
       - Render a card linking to `/series/{slug}`:
         - Thumbnail area at 16:9 aspect ratio with bg-cinema-surface fallback if no thumbnail
         - Title (line-clamp-1 for overflow)
         - Genre badge using getGenreLabel
         - Bottom row: creator name (text-muted-foreground) and episode count (e.g. "12 episodes")
       - Use shadcn Card component as the wrapper
       - Add hover state: scale-[1.02] transition-transform for subtle lift effect
    3. Create `src/components/series/series-grid.tsx`:
       - Accept `series: SeriesWithCreator[]` prop
       - Render responsive CSS grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6`
       - Map over series array and render `SeriesCard` for each
       - Handle empty state: "No series found" message with muted text
    4. Rewrite `src/app/(browse)/browse/page.tsx` (Server Component):
       - Accept `searchParams: Promise<{ genre?: string }>` prop (Next.js 16 async searchParams)
       - Import and call `getSeriesByGenre(genre)` with the genre from searchParams
       - Import `GenreFilter` and `SeriesGrid`
       - Render page title "Browse Series", GenreFilter component, then SeriesGrid with fetched data
       - Keep the `mx-auto max-w-7xl px-4 py-8` container from existing page
  </action>
  <verify>
    - `pnpm build` passes with no TypeScript errors
    - Browse page at /browse renders with genre filter and series grid
    - Genre filter buttons include all 11 genres plus "All"
    - Series cards display all required fields (thumbnail area, title, genre, creator, episode count)
    - Empty state shows when no series match the filter
  </verify>
  <done>Browse page displays a grid of series cards with functional genre filtering. Genre state is in the URL (?genre=thriller). Cards link to /series/{slug}.</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes without errors
2. Browse page renders at /browse with genre filter pills and series grid
3. Clicking a genre filter updates the URL (e.g., ?genre=comedy)
4. Genre filter has all 11 genres plus "All"
5. Series cards show: thumbnail area, title, genre badge, creator name, episode count
6. Empty state displays when no series exist or match the selected genre
7. Cards link to /series/{slug} pages
</verification>

<success_criteria>
- Browse page is a Server Component fetching from Supabase with genre filtering
- Genre filter is a Client Component using nuqs for URL-based state
- Series cards display all required data fields
- Single source of truth for genre labels in src/config/genres.ts
- NuqsAdapter is wired into root layout
</success_criteria>

<output>
After completion, create `.planning/phases/04-content-browsing-sharing/04-01-SUMMARY.md`
</output>
