---
phase: 07-admin-panel
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/modules/admin/actions/homepage.ts
  - src/modules/admin/queries/get-homepage-data.ts
  - src/app/(admin)/admin/homepage/page.tsx
  - src/app/(public)/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view all series and toggle featured status on/off"
    - "Admin can set the display order of featured series"
    - "Admin can manage editorial picks by section (featured, trending, new_releases, staff_picks)"
    - "Public homepage displays featured series in the order set by admin"
  artifacts:
    - path: "src/modules/admin/actions/homepage.ts"
      provides: "Server actions for homepage curation"
      exports: ["toggleFeatured", "updateFeaturedOrder", "addEditorialPick", "removeEditorialPick"]
    - path: "src/modules/admin/queries/get-homepage-data.ts"
      provides: "Queries for featured series and editorial picks"
      exports: ["getFeaturedSeries", "getEditorialPicks", "getAllSeriesForCuration"]
    - path: "src/app/(admin)/admin/homepage/page.tsx"
      provides: "Homepage curation admin page"
      min_lines: 40
    - path: "src/app/(public)/page.tsx"
      provides: "Public homepage with admin-curated featured content"
      min_lines: 30
  key_links:
    - from: "src/app/(admin)/admin/homepage/page.tsx"
      to: "src/modules/admin/actions/homepage.ts"
      via: "form actions for toggle/add/remove"
      pattern: "toggleFeatured|addEditorialPick|removeEditorialPick"
    - from: "src/app/(public)/page.tsx"
      to: "src/modules/admin/queries/get-homepage-data.ts"
      via: "getFeaturedSeries and getEditorialPicks queries"
      pattern: "getFeaturedSeries|getEditorialPicks"
---

<objective>
Build the homepage curation tools and update the public homepage to display admin-curated content (ADMN-03).

Purpose: The homepage is the storefront of the platform. Admin needs to control what content is featured to present the best series to new visitors, especially for pitch readiness.
Output: Admin curation page for featured series and editorial picks, plus an updated public homepage that renders curated content.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-admin-panel/07-RESEARCH.md
@.planning/phases/07-admin-panel/07-01-SUMMARY.md

Reference patterns from:
@src/app/(public)/page.tsx (existing homepage placeholder)
@src/components/content/series-card.tsx (existing SeriesCard component)
@src/components/content/series-grid.tsx (existing SeriesGrid component)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Homepage curation queries, actions, and admin page</name>
  <files>
    src/modules/admin/queries/get-homepage-data.ts
    src/modules/admin/actions/homepage.ts
    src/app/(admin)/admin/homepage/page.tsx
  </files>
  <action>
    1. Create `src/modules/admin/queries/get-homepage-data.ts`:
       - Import `createAdminClient` from `@/lib/supabase/admin`
       - Import `createClient` from `@/lib/supabase/server`

       - Export `getAllSeriesForCuration()`:
         - Uses admin client (needs all series, not just user's)
         - Select: `id, title, slug, genre, status, is_featured, featured_sort_order, thumbnail_url, view_count, profiles!creator_id(display_name)`
         - Filter `status = 'published'`
         - Order by `is_featured desc, featured_sort_order asc, view_count desc`
         - Return typed array

       - Export `getFeaturedSeries()`:
         - Uses regular Supabase client (public query, respects RLS)
         - Select: `id, title, slug, genre, thumbnail_url, description, view_count, profiles!creator_id(display_name, username, avatar_url)`
         - Filter `status = 'published'` AND `is_featured = true`
         - Order by `featured_sort_order asc`
         - Return typed array

       - Export `getEditorialPicks(section?: string)`:
         - Uses regular Supabase client (editorial_picks has public read policy)
         - Select: `id, section, sort_order, series!inner(id, title, slug, genre, thumbnail_url, description, view_count, profiles!creator_id(display_name, username, avatar_url))`
         - If section provided, filter by section
         - Order by `sort_order asc`
         - Return typed array

       - Export `getEditorialPicksAdmin()`:
         - Uses admin client (for admin curation page)
         - Select: `id, section, sort_order, series_id, series!inner(id, title, slug, thumbnail_url, profiles!creator_id(display_name))`
         - Order by `section asc, sort_order asc`
         - Return typed array

    2. Create `src/modules/admin/actions/homepage.ts`:
       - `"use server"` directive
       - Import `requireAdmin`, `createAdminClient`, `revalidatePath`

       - Export `toggleFeatured(seriesId: string, featured: boolean, sortOrder?: number)`:
         a. Call `requireAdmin()`
         b. Admin client update `series` where `id = seriesId`:
            - Set `is_featured = featured`, `featured_sort_order = featured ? (sortOrder ?? 0) : null`
         c. `revalidatePath("/admin/homepage")`
         d. `revalidatePath("/")` (public homepage)
         e. Return `{ success: true }`

       - Export `updateFeaturedOrder(seriesId: string, sortOrder: number)`:
         a. Call `requireAdmin()`
         b. Admin client update `series` where `id = seriesId`, set `featured_sort_order = sortOrder`
         c. Revalidate both paths
         d. Return `{ success: true }`

       - Export `addEditorialPick(seriesId: string, section: string, sortOrder?: number)`:
         a. Call `requireAdmin()`
         b. Get admin user id
         c. Admin client insert into `editorial_picks`: `{ series_id: seriesId, section, sort_order: sortOrder ?? 0, added_by: user.id }`
         d. Use `onConflict: 'series_id,section'` or handle duplicate gracefully
         e. Revalidate paths
         f. Return `{ success: true }`

       - Export `removeEditorialPick(pickId: string)`:
         a. Call `requireAdmin()`
         b. Admin client delete from `editorial_picks` where `id = pickId`
         c. Revalidate paths
         d. Return `{ success: true }`

    3. Create `src/app/(admin)/admin/homepage/page.tsx`:
       - Server component, call `requireAdmin()` at top
       - Fetch data: `getAllSeriesForCuration()` and `getEditorialPicksAdmin()`

       - Page layout with two sections:

       **Section 1: Featured Series**
       - Heading: "Featured Series"
       - Description: "Toggle which series appear as featured on the homepage and set their display order."
       - Render all published series in a table/list:
         - Columns: Thumbnail, Title, Creator, Views, Featured (toggle), Sort Order (input)
         - Featured toggle: a form button that calls `toggleFeatured`. Use a client component `FeaturedToggle` with:
           - Checkbox/switch that submits a form action on change
           - Shows filled star when featured, outline star when not
         - Sort order: a small number input (visible only when featured=true)
           - On blur/submit, calls `updateFeaturedOrder`
       - Use client components for interactive elements (toggles, sort order inputs)

       **Section 2: Editorial Picks**
       - Heading: "Editorial Picks"
       - Description: "Add series to curated sections for homepage display."
       - Show existing picks grouped by section (featured, trending, new_releases, staff_picks)
       - Each pick shows: series title, section, sort order, remove button
       - Add pick form: select a series (dropdown from all published series), select a section (dropdown), set sort order, submit
       - Use a client component `AddPickForm` for the add form
       - Remove button calls `removeEditorialPick`
  </action>
  <verify>
    - `npx biome check --no-errors-on-unmatched src/modules/admin/queries/get-homepage-data.ts src/modules/admin/actions/homepage.ts "src/app/(admin)/admin/homepage/**/*.tsx"` passes
    - `pnpm tsc --noEmit` passes
  </verify>
  <done>
    Admin can toggle featured status on any published series, set display order for featured series, add series to editorial pick sections, and remove editorial picks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update public homepage with admin-curated featured content</name>
  <files>
    src/app/(public)/page.tsx
  </files>
  <action>
    1. Update `src/app/(public)/page.tsx`:
       - Replace the current placeholder content with a real homepage
       - Import `getFeaturedSeries` and `getEditorialPicks` from `@/modules/admin/queries/get-homepage-data`
       - Import `SeriesCard` from `@/components/content/series-card` (or equivalent component)
       - Import `Link` from `next/link`

       - Page structure:
         a. **Hero section**: Platform tagline, brief description, "Browse Series" CTA linking to `/browse`
            - "Discover MicroShorts" heading
            - "Short-form series. Big stories. Watch free, unlock more." tagline
            - Browse button styled with brand-yellow

         b. **Featured Series section** (only renders if featured series exist):
            - "Featured" section heading
            - Grid of featured series using SeriesCard component (or a larger featured card variant)
            - Responsive: 1 col mobile, 2 cols md, 3 cols lg

         c. **Editorial Pick sections** (one per section that has picks):
            - Query `getEditorialPicks()` for all picks
            - Group by section
            - Render each section with a heading derived from section name:
              - `'trending'` -> "Trending Now"
              - `'new_releases'` -> "New Releases"
              - `'staff_picks'` -> "Staff Picks"
              - `'featured'` -> skip (already shown above in featured section)
            - Each section renders a horizontal scroll or grid of series cards

         d. **CTA section** at bottom: "Ready to create?" with link to `/dashboard` for creator signup

       - If no featured series and no editorial picks exist (empty platform), show:
         - The hero section with platform description
         - A "Coming soon" message or just the Browse CTA
         - This handles the pre-seeded state gracefully

       - Use existing Tailwind classes for styling (dark theme, brand-yellow accents)
  </action>
  <verify>
    - `npx biome check --no-errors-on-unmatched "src/app/(public)/page.tsx"` passes
    - `pnpm tsc --noEmit` passes
    - Navigate to `/` -- homepage renders without errors
    - If featured series exist in DB, they appear on the homepage in the configured order
  </verify>
  <done>
    Public homepage displays admin-curated featured series and editorial picks. Empty state is handled gracefully. Homepage sections match the order and content configured by admin.
  </done>
</task>

</tasks>

<verification>
- Admin homepage curation page at `/admin/homepage` loads with all published series
- Toggling featured status on a series is reflected on the public homepage at `/`
- Editorial picks can be added and removed, and appear in the correct section on the homepage
- Featured series display in the sort order set by the admin
- Homepage renders gracefully with no data (empty platform state)
</verification>

<success_criteria>
- Admin has full control over which series are featured and in what order
- Editorial picks enable multiple homepage sections (trending, new releases, staff picks)
- Public homepage is no longer a placeholder -- it renders curated content
- Changes by admin are immediately visible on the public homepage (via revalidatePath)
</success_criteria>

<output>
After completion, create `.planning/phases/07-admin-panel/07-03-SUMMARY.md`
</output>
