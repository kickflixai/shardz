---
phase: 03-video-player
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/player/auto-continue.tsx
  - src/components/player/video-player.tsx
  - src/app/(browse)/series/[slug]/episode/[episodeNumber]/page.tsx
autonomous: true

must_haves:
  truths:
    - "When an episode ends, the next episode auto-plays after a brief countdown"
    - "User can cancel or skip the auto-continue countdown"
    - "User can toggle subtitles on and off while watching"
    - "User cannot right-click to save the video or see a download button"
  artifacts:
    - path: "src/components/player/auto-continue.tsx"
      provides: "Countdown overlay with next-episode preview and skip/cancel controls"
      exports: ["AutoContinue"]
    - path: "src/components/player/video-player.tsx"
      provides: "Updated VideoPlayer with auto-continue integration and subtitle defaults"
      contains: "AutoContinue"
  key_links:
    - from: "src/components/player/auto-continue.tsx"
      to: "next/navigation"
      via: "router.push() for client-side episode transition"
      pattern: "useRouter.*router\\.push"
    - from: "src/components/player/video-player.tsx"
      to: "src/components/player/auto-continue.tsx"
      via: "renders AutoContinue overlay on episode end"
      pattern: "import.*AutoContinue"
---

<objective>
Add auto-continue between episodes, subtitle toggle support, and finalize content protection -- completing all Phase 3 success criteria.

Purpose: Auto-continue keeps viewers watching (critical for engagement and conversion). Subtitles make content accessible. Content protection satisfies PLAT-04 requirement.

Output: Updated player components with auto-continue overlay, subtitle defaults, and hardened content protection.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-video-player/03-RESEARCH.md
@.planning/phases/03-video-player/03-01-SUMMARY.md
@.planning/phases/03-video-player/03-02-SUMMARY.md
@src/components/player/video-player.tsx
@src/components/player/video-player-shell.tsx
@src/components/player/player-layout.tsx
@src/app/(browse)/series/[slug]/episode/[episodeNumber]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auto-continue countdown overlay and integrate into VideoPlayer</name>
  <files>
    src/components/player/auto-continue.tsx
    src/components/player/video-player.tsx
  </files>
  <action>
    1. Create `src/components/player/auto-continue.tsx` (Client Component):
       - "use client" directive
       - Import useRouter from "next/navigation"
       - Props interface:
         ```typescript
         interface AutoContinueProps {
           nextEpisodeUrl: string;
           nextEpisodeTitle?: string;
           countdownSeconds?: number; // default: 5
           onCancel: () => void;
         }
         ```
       - State: countdown (number, starts at countdownSeconds), active (boolean)
       - useEffect with setInterval that decrements countdown every second
       - When countdown reaches 0: call router.push(nextEpisodeUrl) for client-side navigation (no full page reload, preserves app shell)
       - Render an overlay positioned absolutely over the player:
         - Semi-transparent dark backdrop (bg-black/80)
         - "Next Episode" heading
         - Next episode title if provided
         - Circular countdown indicator (a ring that depletes, or a simple number countdown)
         - "Play Now" button (skips countdown, navigates immediately)
         - "Cancel" button (calls onCancel, hides overlay, stays on current episode)
       - Styling: cinematic feel with brand-yellow accent on the "Play Now" button, white text on dark overlay
       - Use Tailwind classes, no external animation libraries
       - The countdown ring can be a simple circular border animation or just a large number

    2. Update `src/components/player/video-player.tsx`:
       - Import AutoContinue from "./auto-continue"
       - Add state: `showAutoContinue` (boolean, default false)
       - On MuxPlayer onEnded event:
         - If nextEpisodeUrl is provided: set showAutoContinue to true
         - If no nextEpisodeUrl: do nothing (last episode in season)
       - Render AutoContinue conditionally:
         - When showAutoContinue is true AND nextEpisodeUrl exists
         - Position it as an overlay on top of the player container
         - Pass onCancel={() => setShowAutoContinue(false)}
       - Wrap the MuxPlayer and AutoContinue in a relative-positioned container for overlay positioning
       - Add `defaultHiddenCaptions={false}` to MuxPlayer to show subtitles/captions by default when available (user can toggle off via MuxPlayer's built-in CC button)
       - MuxPlayer's built-in UI includes a CC/subtitle toggle button automatically when text tracks are available on the Mux asset -- no custom subtitle toggle component needed
       - Ensure autoPlay prop is passed through: when navigating from auto-continue, the new page's player should attempt autoplay via the autoPlay="any" prop
  </action>
  <verify>
    - `pnpm build` passes with no TypeScript errors
    - `src/components/player/auto-continue.tsx` exports AutoContinue component
    - VideoPlayer renders AutoContinue overlay when an episode ends and nextEpisodeUrl is provided
    - AutoContinue has "Play Now" and "Cancel" buttons
    - MuxPlayer has defaultHiddenCaptions={false} for subtitle display
  </verify>
  <done>
    When an episode ends and a next episode exists, a 5-second countdown overlay appears with "Play Now" (skip) and "Cancel" options. After countdown or skip, the app navigates to the next episode via client-side routing. Subtitles display by default when available on the Mux asset.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire auto-continue data flow in episode page and verify all success criteria</name>
  <files>
    src/app/(browse)/series/[slug]/episode/[episodeNumber]/page.tsx
  </files>
  <action>
    1. Update the episode page to pass next episode information to the player:
       - The page already fetches the current episode and determines nextEpisodeUrl from Plan 03-02
       - Additionally fetch the next episode's title for the auto-continue overlay:
         - Query: select title from episodes where season_id = current.season_id AND episode_number = current.episode_number + 1
         - Pass nextEpisodeTitle to VideoPlayerShell (add as optional prop)
       - VideoPlayerShell passes nextEpisodeTitle through to VideoPlayer
       - VideoPlayer passes it to AutoContinue

    2. Update VideoPlayerShell to accept and forward nextEpisodeTitle:
       - Add `nextEpisodeTitle?: string` to VideoPlayerShellProps
       - Pass it to VideoPlayer

    3. Verify all Phase 3 success criteria are met:
       - SC1: Mobile 9:16 vertical player -- PlayerLayout provides this (from 03-02)
       - SC2: Desktop theater mode -- PlayerLayout provides this (from 03-02)
       - SC3: Auto-continue -- AutoContinue overlay + router.push on countdown complete
       - SC4: Subtitle toggle -- MuxPlayer's built-in CC button + defaultHiddenCaptions={false}
       - SC5: No right-click / no download -- onContextMenu preventDefault on player + container, MuxPlayer has no download button by default, userSelect: none on container

    4. Final content protection hardening on the episode page:
       - Ensure the entire player area (PlayerLayout wrapper) has onContextMenu disabled
       - Ensure userSelect: none / WebkitUserSelect: none is on the player container
       - These should already be in PlayerLayout from 03-02, verify they are present and add if missing
  </action>
  <verify>
    - `pnpm build` passes with no TypeScript errors
    - Episode page passes nextEpisodeUrl AND nextEpisodeTitle to VideoPlayerShell
    - All 5 Phase 3 success criteria are addressed in the codebase:
      1. Vertical 9:16 player (PlayerLayout responsive container)
      2. Desktop theater mode (PlayerLayout md: styles)
      3. Auto-continue (AutoContinue component + onEnded handler)
      4. Subtitle toggle (MuxPlayer CC button + defaultHiddenCaptions)
      5. Content protection (onContextMenu, no download button, userSelect none)
  </verify>
  <done>
    Auto-continue shows the next episode's title in the countdown overlay. All 5 Phase 3 success criteria are implemented: vertical mobile player, desktop theater mode, auto-continue between episodes, subtitle toggle, and content protection (right-click disabled, no download button).
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds with no TypeScript errors
2. Auto-continue overlay appears when an episode ends (if next episode exists)
3. Countdown timer counts down from 5 and navigates to next episode
4. "Play Now" skips countdown; "Cancel" dismisses overlay
5. Subtitles show by default when text tracks are on the Mux asset
6. Right-click is disabled on the player area
7. No download button visible in the player controls
</verification>

<success_criteria>
- Auto-continue countdown (5 seconds) triggers on episode end when next episode exists
- User can skip countdown ("Play Now") or cancel it ("Cancel")
- Navigation to next episode uses router.push() for seamless client-side transition
- Subtitles display by default via MuxPlayer's defaultHiddenCaptions={false}
- MuxPlayer's built-in CC button allows toggling subtitles on/off
- Content protection: right-click disabled, no download button, user-select none
- All 5 Phase 3 success criteria are fully addressed
</success_criteria>

<output>
After completion, create `.planning/phases/03-video-player/03-03-SUMMARY.md`
</output>
