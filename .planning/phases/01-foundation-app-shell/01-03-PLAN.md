---
phase: 01-foundation-app-shell
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/(public)/layout.tsx
  - src/app/(public)/page.tsx
  - src/app/(public)/loading.tsx
  - src/app/(auth)/layout.tsx
  - src/app/(auth)/login/page.tsx
  - src/app/(auth)/signup/page.tsx
  - src/app/(browse)/layout.tsx
  - src/app/(browse)/browse/page.tsx
  - src/app/(browse)/browse/loading.tsx
  - src/app/(browse)/series/[slug]/page.tsx
  - src/app/(browse)/series/[slug]/loading.tsx
  - src/app/(creator)/layout.tsx
  - src/app/(creator)/dashboard/page.tsx
  - src/app/(creator)/loading.tsx
  - src/app/(admin)/layout.tsx
  - src/app/(admin)/admin/page.tsx
  - src/app/(admin)/loading.tsx
  - src/app/manifest.ts
  - src/app/sw.ts
  - src/app/serwist/[path]/route.ts
  - src/app/loading.tsx
  - src/app/error.tsx
  - src/app/global-error.tsx
  - src/app/not-found.tsx
  - src/app/~offline/page.tsx
  - src/app/layout.tsx
  - src/components/providers/serwist-provider.tsx
  - src/components/layout/header.tsx
  - src/components/layout/footer.tsx
  - src/components/layout/mobile-nav.tsx
  - src/components/layout/sidebar.tsx
  - src/middleware.ts
  - public/icon-192x192.png
  - public/icon-512x512.png
autonomous: true

must_haves:
  truths:
    - "User can navigate to /browse, /series/test, /login, /signup, /dashboard, /admin and see distinct placeholder pages"
    - "Each route group displays a loading spinner while content loads"
    - "PWA manifest is served at /manifest.webmanifest with MicroShort branding"
    - "Service worker registers successfully in production build"
    - "Application renders responsively on mobile (375px) and desktop (1440px) viewports"
    - "Header and footer appear on public and browse pages; sidebar appears on creator and admin pages"
  artifacts:
    - path: "src/app/(public)/page.tsx"
      provides: "Homepage placeholder"
      contains: "MicroShort"
    - path: "src/app/(public)/layout.tsx"
      provides: "Public layout with header and footer"
      contains: "Header"
    - path: "src/app/(auth)/layout.tsx"
      provides: "Auth layout with centered card"
      contains: "layout"
    - path: "src/app/(browse)/layout.tsx"
      provides: "Browse layout with header and footer"
      contains: "Header"
    - path: "src/app/(creator)/layout.tsx"
      provides: "Creator dashboard layout with sidebar"
      contains: "Sidebar"
    - path: "src/app/(admin)/layout.tsx"
      provides: "Admin layout with sidebar"
      contains: "Sidebar"
    - path: "src/app/manifest.ts"
      provides: "PWA web app manifest"
      contains: "MicroShort"
    - path: "src/app/sw.ts"
      provides: "Service worker with Serwist runtime caching"
      contains: "Serwist"
    - path: "src/app/serwist/[path]/route.ts"
      provides: "Serwist route handler for service worker serving"
      contains: "createSerwistRoute"
    - path: "src/components/providers/serwist-provider.tsx"
      provides: "SerwistProvider re-export for PWA"
      contains: "SerwistProvider"
    - path: "src/middleware.ts"
      provides: "Next.js middleware for Supabase session refresh"
      contains: "updateSession"
    - path: "src/components/layout/header.tsx"
      provides: "App header with navigation"
      contains: "MicroShort"
    - path: "src/components/layout/footer.tsx"
      provides: "App footer"
      contains: "footer"
    - path: "src/components/layout/sidebar.tsx"
      provides: "Dashboard/admin sidebar navigation"
      contains: "sidebar"
    - path: "src/app/error.tsx"
      provides: "Error boundary with retry button"
      contains: "reset"
    - path: "src/app/not-found.tsx"
      provides: "404 page"
      contains: "404"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/providers/serwist-provider.tsx"
      via: "import SerwistProvider, wraps children"
      pattern: "SerwistProvider"
    - from: "src/app/serwist/[path]/route.ts"
      to: "@serwist/turbopack/route"
      via: "createSerwistRoute"
      pattern: "createSerwistRoute"
    - from: "src/app/(public)/layout.tsx"
      to: "src/components/layout/header.tsx"
      via: "import Header"
      pattern: "import.*Header"
    - from: "src/app/(creator)/layout.tsx"
      to: "src/components/layout/sidebar.tsx"
      via: "import Sidebar"
      pattern: "import.*Sidebar"
    - from: "src/middleware.ts"
      to: "src/lib/supabase/middleware.ts"
      via: "import updateSession"
      pattern: "import.*updateSession"
    - from: "src/app/manifest.ts"
      to: "public/icon-*.png"
      via: "icons array referencing /icon-192x192.png and /icon-512x512.png"
      pattern: "icon-192x192"
---

<objective>
Build the application shell with route group scaffolding, shared layout components, PWA setup (manifest, service worker, offline page), and global error/loading states. This creates the navigable structure users will interact with.

Purpose: The app shell provides the skeleton that all features plug into. Route groups give each audience (public, auth, browse, creator, admin) its own layout. PWA makes the app installable. Loading/error states ensure graceful UX from day one.
Output: A navigable app shell with all major routes, responsive layouts, PWA manifest, and service worker.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-app-shell/01-RESEARCH.md
@.planning/phases/01-foundation-app-shell/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create route groups, layouts, placeholder pages, and loading/error states</name>
  <files>
    src/app/(public)/layout.tsx
    src/app/(public)/page.tsx
    src/app/(public)/loading.tsx
    src/app/(auth)/layout.tsx
    src/app/(auth)/login/page.tsx
    src/app/(auth)/signup/page.tsx
    src/app/(browse)/layout.tsx
    src/app/(browse)/browse/page.tsx
    src/app/(browse)/browse/loading.tsx
    src/app/(browse)/series/[slug]/page.tsx
    src/app/(browse)/series/[slug]/loading.tsx
    src/app/(creator)/layout.tsx
    src/app/(creator)/dashboard/page.tsx
    src/app/(creator)/loading.tsx
    src/app/(admin)/layout.tsx
    src/app/(admin)/admin/page.tsx
    src/app/(admin)/loading.tsx
    src/app/loading.tsx
    src/app/error.tsx
    src/app/global-error.tsx
    src/app/not-found.tsx
    src/components/layout/header.tsx
    src/components/layout/footer.tsx
    src/components/layout/mobile-nav.tsx
    src/components/layout/sidebar.tsx
    src/middleware.ts
  </files>
  <action>
1. **Delete the default page.tsx** created by create-next-app (it conflicts with route group pages):
   ```bash
   rm src/app/page.tsx
   ```

2. **Create shared layout components** (all use cinematic theme tokens from globals.css):

   `src/components/layout/header.tsx` -- Client component with:
   - Fixed position at top, z-50
   - Deep black background (bg-background/95 backdrop-blur)
   - MicroShort logo text in cinematic yellow (text-primary font-bold text-xl)
   - Navigation links: Home, Browse (hidden on mobile, visible on md+)
   - Mobile hamburger button (visible on mobile, hidden on md+)
   - Responsive: stacks on mobile, horizontal on desktop
   - Use `"use client"` directive (needs onClick for mobile menu)

   `src/components/layout/footer.tsx` -- Server component with:
   - Border-t border-border for subtle separator
   - Muted text (text-muted-foreground)
   - Copyright text and minimal links
   - Responsive padding

   `src/components/layout/mobile-nav.tsx` -- Client component with:
   - Full-screen overlay on mobile (fixed inset-0, bg-background/98)
   - Navigation links styled with cinematic yellow hover
   - Close button
   - Hidden on desktop

   `src/components/layout/sidebar.tsx` -- Client component with:
   - Fixed left sidebar (hidden on mobile, visible on lg+)
   - Dark surface background (bg-card)
   - Navigation items with active state (text-primary for active, text-muted-foreground for inactive)
   - Accept a `variant` prop: "creator" | "admin" to render different nav items
   - Creator nav: Dashboard, My Series, Analytics, Settings (all placeholder links)
   - Admin nav: Dashboard, Creators, Content, Users, Settings (all placeholder links)
   - Collapsible on tablet (md) -- show icons only

3. **Create route group layouts:**

   `src/app/(public)/layout.tsx` -- Header + main (flex-1) + Footer:
   ```tsx
   import { Header } from "@/components/layout/header";
   import { Footer } from "@/components/layout/footer";

   export default function PublicLayout({ children }: { children: React.ReactNode }) {
     return (
       <div className="flex min-h-screen flex-col">
         <Header />
         <main className="flex-1">{children}</main>
         <Footer />
       </div>
     );
   }
   ```

   `src/app/(auth)/layout.tsx` -- Centered card layout (no header/footer):
   ```tsx
   export default function AuthLayout({ children }: { children: React.ReactNode }) {
     return (
       <div className="flex min-h-screen items-center justify-center bg-background p-4">
         <div className="w-full max-w-md">{children}</div>
       </div>
     );
   }
   ```

   `src/app/(browse)/layout.tsx` -- Header + main + Footer (same as public but separate group for future browse-specific features):
   Uses Header and Footer components.

   `src/app/(creator)/layout.tsx` -- Sidebar (variant="creator") + main content area:
   ```tsx
   import { Sidebar } from "@/components/layout/sidebar";

   export default function CreatorLayout({ children }: { children: React.ReactNode }) {
     return (
       <div className="flex min-h-screen">
         <Sidebar variant="creator" />
         <main className="flex-1 p-4 lg:ml-64">{children}</main>
       </div>
     );
   }
   ```

   `src/app/(admin)/layout.tsx` -- Same pattern as creator but with variant="admin".

4. **Create placeholder pages** -- Each page is a simple server component with:
   - A heading identifying the page (e.g., "Home", "Browse Series", "Login", etc.)
   - Brief description text ("Coming in Phase N")
   - Use cinematic theme tokens: text-foreground for headings, text-muted-foreground for descriptions
   - The homepage (`(public)/page.tsx`) should have a slightly more substantial placeholder:
     - "MicroShort" in large primary-colored text
     - Tagline: "Premium microshort video series"
     - A "Browse Series" link styled as a primary button (bg-primary text-primary-foreground)

   Pages to create:
   - `src/app/(public)/page.tsx` -- Homepage
   - `src/app/(auth)/login/page.tsx` -- Login placeholder
   - `src/app/(auth)/signup/page.tsx` -- Signup placeholder
   - `src/app/(browse)/browse/page.tsx` -- Browse by genre placeholder
   - `src/app/(browse)/series/[slug]/page.tsx` -- Series detail placeholder (receives `params.slug`)
   - `src/app/(creator)/dashboard/page.tsx` -- Creator dashboard placeholder
   - `src/app/(admin)/admin/page.tsx` -- Admin dashboard placeholder

5. **Create loading states** -- Each is a centered spinner using cinematic yellow:
   ```tsx
   export default function Loading() {
     return (
       <div className="flex min-h-[50vh] items-center justify-center">
         <div className="h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent" />
       </div>
     );
   }
   ```
   Create for: `(public)/loading.tsx`, `(browse)/browse/loading.tsx`, `(browse)/series/[slug]/loading.tsx`, `(creator)/loading.tsx`, `(admin)/loading.tsx`, root `app/loading.tsx`.

6. **Create error boundaries:**

   `src/app/error.tsx` -- Client component ("use client") with:
   - Error message display (text-foreground)
   - "Try again" button (bg-primary text-primary-foreground)
   - `reset()` function on button click
   - Centered layout

   `src/app/global-error.tsx` -- Client component for root layout errors:
   - MUST include its own `<html>` and `<body>` tags (root layout may have errored)
   - Minimal styling (inline styles, since globals.css may not load)
   - "Try again" button with `reset()`

   `src/app/not-found.tsx` -- Server component:
   - "404" in large primary text
   - "Page not found" message
   - Link back to home

7. **Create Next.js middleware** (`src/middleware.ts`):
   ```typescript
   import { type NextRequest } from "next/server";
   import { updateSession } from "@/lib/supabase/middleware";

   export async function middleware(request: NextRequest) {
     return await updateSession(request);
   }

   export const config = {
     matcher: [
       "/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)",
     ],
   };
   ```

8. Verify: `pnpm build` succeeds. Navigate to `/`, `/browse`, `/login`, `/signup`, `/dashboard`, `/admin` in dev mode.
  </action>
  <verify>
    `pnpm build` succeeds. Count route pages: `find src/app -name "page.tsx" | wc -l` returns 7 (home, login, signup, browse, series/[slug], dashboard, admin). `find src/app -name "loading.tsx" | wc -l` returns at least 6. `grep "Header" src/app/\(public\)/layout.tsx` confirms header is imported. `grep "Sidebar" src/app/\(creator\)/layout.tsx` confirms sidebar is imported.
  </verify>
  <done>All 5 route groups have layouts, all 7 placeholder pages exist, loading spinners are in every route group, error boundaries handle both route-level and root-level errors, 404 page exists, and the Next.js middleware refreshes Supabase sessions on every request.</done>
</task>

<task type="auto">
  <name>Task 2: Set up PWA manifest, service worker, offline page, and app icons</name>
  <files>
    src/app/manifest.ts
    src/app/sw.ts
    src/app/serwist/[path]/route.ts
    src/components/providers/serwist-provider.tsx
    src/app/~offline/page.tsx
    src/app/layout.tsx
    public/icon-192x192.png
    public/icon-512x512.png
  </files>
  <action>
1. **Create PWA manifest** (`src/app/manifest.ts`):
   Follow RESEARCH.md "PWA Manifest (Dynamic)" pattern exactly:
   - name: "MicroShort"
   - short_name: "MicroShort"
   - description: "Premium microshort video series"
   - start_url: "/"
   - display: "standalone"
   - orientation: "portrait"
   - background_color: "#141414" (deep cinema black)
   - theme_color: "#141414"
   - Icons: 192x192 and 512x512 (png), plus 512x512 maskable

2. **Create service worker** (`src/app/sw.ts`):
   Follow RESEARCH.md "Pattern 4: PWA with Serwist Turbopack" exactly:
   - `/// <reference lib="webworker" />`
   - Import `defaultCache` from `@serwist/turbopack/worker`
   - Import `PrecacheEntry`, `SerwistGlobalConfig`, `Serwist` from `serwist`
   - Declare global `WorkerGlobalScope` with `__SW_MANIFEST`
   - Create Serwist instance with precacheEntries, skipWaiting, clientsClaim, navigationPreload, runtimeCaching (defaultCache)
   - Add offline fallback to `/~offline` for document requests
   - Call `serwist.addEventListeners()`

3. **Create Serwist route handler** (`src/app/serwist/[path]/route.ts`):
   ```typescript
   import { createSerwistRoute } from "@serwist/turbopack/route";
   export const { GET } = createSerwistRoute();
   ```

4. **Create SerwistProvider** (`src/components/providers/serwist-provider.tsx`):
   ```typescript
   "use client";
   export { SerwistProvider } from "@serwist/turbopack/react";
   ```

5. **Create offline fallback page** (`src/app/~offline/page.tsx`):
   - Simple page with "You're offline" message
   - MicroShort branding (primary color heading)
   - "Please check your internet connection" in muted text
   - Use cinematic theme tokens

6. **Update root layout** (`src/app/layout.tsx`):
   - Import SerwistProvider from `@/components/providers/serwist-provider`
   - Wrap children with SerwistProvider INSIDE ThemeProvider:
   ```tsx
   <ThemeProvider ...>
     <SerwistProvider swUrl="/serwist/sw.js">
       {children}
     </SerwistProvider>
   </ThemeProvider>
   ```

7. **Generate placeholder app icons:**
   Create simple placeholder PNG icons at `public/icon-192x192.png` and `public/icon-512x512.png`. Use a bash command to generate minimal valid PNGs (solid dark background with a yellow "M" or just solid colored squares). These are placeholders -- proper branded icons will come in a later phase.

   Option A (if ImageMagick is available):
   ```bash
   convert -size 192x192 xc:"#141414" -fill "#E0B800" -gravity center -pointsize 120 -annotate 0 "M" public/icon-192x192.png
   convert -size 512x512 xc:"#141414" -fill "#E0B800" -gravity center -pointsize 300 -annotate 0 "M" public/icon-512x512.png
   ```

   Option B (if ImageMagick is not available):
   Use a tiny valid PNG generated via a Node.js script or download a placeholder. At minimum, create a 1x1 pixel PNG that will be replaced later. The manifest requires these files to exist.

8. Verify: `pnpm build` succeeds. Check that the manifest is accessible at `/manifest.webmanifest` in the built output. Verify the service worker route exists.
  </action>
  <verify>
    `pnpm build` succeeds. `grep "MicroShort" src/app/manifest.ts` confirms manifest content. `grep "Serwist" src/app/sw.ts` confirms service worker setup. `grep "createSerwistRoute" src/app/serwist/\\[path\\]/route.ts` confirms route handler. `grep "SerwistProvider" src/app/layout.tsx` confirms provider is in root layout. `ls public/icon-192x192.png public/icon-512x512.png` confirms icons exist.
  </verify>
  <done>PWA manifest serves MicroShort branding with standalone display mode. Service worker is configured with Serwist for precaching, runtime caching, and offline fallback. SerwistProvider wraps the app in the root layout. Placeholder app icons exist. Offline page shows branded message.</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes successfully
2. Navigate to `/` -- see homepage with MicroShort branding
3. Navigate to `/browse` -- see browse placeholder with header/footer
4. Navigate to `/login` -- see login placeholder with centered card layout
5. Navigate to `/dashboard` -- see creator dashboard with sidebar
6. Navigate to `/admin` -- see admin dashboard with sidebar
7. Navigate to `/nonexistent` -- see 404 page
8. `curl http://localhost:3000/manifest.webmanifest` returns JSON with "MicroShort" (after `pnpm start`)
9. Loading spinners appear briefly on navigation (or can be verified by adding artificial delay)
10. Application is responsive: header collapses on mobile, sidebar hidden on mobile
</verification>

<success_criteria>
- All 7 placeholder pages render in their correct route groups
- Route group layouts provide distinct experiences (header/footer for public/browse, centered card for auth, sidebar for creator/admin)
- Loading spinners appear in every route group
- Error boundaries catch and display errors gracefully
- 404 page renders for unknown routes
- PWA manifest is served with correct MicroShort branding
- Service worker is configured and registers in production builds
- Offline page displays when network is unavailable
- Header is responsive (hamburger on mobile, links on desktop)
- Sidebar is responsive (hidden on mobile, visible on desktop)
- Middleware refreshes Supabase sessions on every request
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-app-shell/01-03-SUMMARY.md`
</output>
