---
phase: 01-foundation-app-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - next.config.ts
  - package.json
  - pnpm-lock.yaml
  - tsconfig.json
  - postcss.config.mjs
  - components.json
  - biome.json
  - .env.local
  - .env.example
  - src/app/globals.css
  - src/app/layout.tsx
  - src/lib/supabase/server.ts
  - src/lib/supabase/client.ts
  - src/lib/supabase/middleware.ts
  - src/lib/utils.ts
  - src/config/env.ts
  - src/components/providers/theme-provider.tsx
autonomous: true

must_haves:
  truths:
    - "Next.js project builds successfully with `pnpm build` and starts with `pnpm dev`"
    - "Application renders with deep blacks (oklch 0.08) and cinematic yellow (oklch 0.88 0.18 90) branding"
    - "Supabase server and browser client files exist and export createClient functions"
    - "Biome linter and formatter run without errors on all source files"
  artifacts:
    - path: "next.config.ts"
      provides: "Next.js configuration with Serwist Turbopack wrapper"
      contains: "withSerwist"
    - path: "src/app/globals.css"
      provides: "Tailwind v4 theme with cinematic brand colors"
      contains: "oklch(0.88 0.18 90)"
    - path: "src/app/layout.tsx"
      provides: "Root layout with ThemeProvider and metadata"
      contains: "ThemeProvider"
    - path: "src/lib/supabase/server.ts"
      provides: "Server-side Supabase client factory"
      exports: ["createClient"]
    - path: "src/lib/supabase/client.ts"
      provides: "Browser-side Supabase client factory"
      exports: ["createClient"]
    - path: "src/lib/supabase/middleware.ts"
      provides: "Supabase middleware helper for session refresh"
      exports: ["updateSession"]
    - path: "src/config/env.ts"
      provides: "Environment variable validation"
      contains: "NEXT_PUBLIC_SUPABASE_URL"
    - path: "src/components/providers/theme-provider.tsx"
      provides: "next-themes ThemeProvider wrapper"
      contains: "defaultTheme"
    - path: "biome.json"
      provides: "Biome linter and formatter configuration"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/providers/theme-provider.tsx"
      via: "import ThemeProvider"
      pattern: "import.*ThemeProvider"
    - from: "next.config.ts"
      to: "@serwist/turbopack"
      via: "withSerwist wrapper"
      pattern: "withSerwist"
    - from: "src/app/globals.css"
      to: "shadcn/ui components"
      via: "CSS variables (--primary, --background, etc.)"
      pattern: "--primary.*oklch"
---

<objective>
Create the Next.js 16 project from scratch with all Phase 1 dependencies installed, Supabase client integration, cinematic dark-first theming via Tailwind v4 + shadcn/ui, and development tooling.

Purpose: This is the foundation everything else builds on. Without the project structure, theming, and Supabase integration, no other plan can execute.
Output: A buildable Next.js 16 project with cinematic branding, Supabase clients, and Biome configured.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-app-shell/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js project and install all dependencies</name>
  <files>
    package.json
    pnpm-lock.yaml
    tsconfig.json
    next.config.ts
    postcss.config.mjs
    biome.json
  </files>
  <action>
1. Create the Next.js project:
   ```bash
   pnpm create next-app@latest microshort --yes
   cd microshort
   ```
   The `--yes` flag accepts defaults: TypeScript, Tailwind CSS, App Router, Turbopack, `src/` directory.

2. Install all Phase 1 dependencies:
   ```bash
   # Supabase
   pnpm add @supabase/supabase-js @supabase/ssr

   # PWA (Serwist with Turbopack support)
   pnpm add -D @serwist/turbopack esbuild serwist

   # Theme management
   pnpm add next-themes

   # Dev tools
   pnpm add -D @biomejs/biome
   ```

3. Initialize shadcn/ui:
   ```bash
   pnpm dlx shadcn@latest init --defaults
   ```
   This auto-detects Tailwind v4, sets up `components.json`, generates CSS variables in `globals.css`, and adds `src/lib/utils.ts` with the `cn()` utility. Accept default settings (New York style, zinc palette -- we override colors in Task 2).

4. Configure Biome (`biome.json`):
   ```json
   {
     "$schema": "https://biomejs.dev/schemas/2.0.0/schema.json",
     "organizeImports": { "enabled": true },
     "linter": {
       "enabled": true,
       "rules": { "recommended": true }
     },
     "formatter": {
       "enabled": true,
       "indentStyle": "tab",
       "lineWidth": 100
     },
     "javascript": {
       "formatter": { "quoteStyle": "double", "semicolons": "always" }
     }
   }
   ```

5. Update `next.config.ts` to use Serwist Turbopack wrapper:
   ```typescript
   import withSerwist from "@serwist/turbopack";

   const nextConfig = withSerwist({
     serverExternalPackages: ["esbuild"],
   });

   export default nextConfig;
   ```

6. Remove the default ESLint config files if `create-next-app` generated them (`.eslintrc.json` or `eslint.config.mjs`). Biome replaces ESLint. Also remove `eslint` and `eslint-config-next` from package.json dependencies if present:
   ```bash
   rm -f .eslintrc.json eslint.config.mjs
   pnpm remove eslint eslint-config-next 2>/dev/null || true
   ```

7. Verify the project builds:
   ```bash
   pnpm build
   ```
  </action>
  <verify>
    `pnpm build` completes without errors. `ls node_modules/@serwist/turbopack` confirms Serwist installed. `ls node_modules/@supabase/ssr` confirms Supabase SSR installed. `cat biome.json` shows Biome config.
  </verify>
  <done>Next.js 16 project exists with all dependencies installed, Biome configured, ESLint removed, and `pnpm build` succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Configure Supabase clients, environment validation, and cinematic theme</name>
  <files>
    src/lib/supabase/server.ts
    src/lib/supabase/client.ts
    src/lib/supabase/middleware.ts
    src/config/env.ts
    src/components/providers/theme-provider.tsx
    src/app/globals.css
    src/app/layout.tsx
    .env.local
    .env.example
  </files>
  <action>
1. Create `.env.local` and `.env.example` with Supabase env vars:
   ```
   NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
   NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=your-anon-key-here
   ```
   Use the local Supabase URL as default. The `.env.example` has the same keys with placeholder values.

2. Create `src/config/env.ts` for environment variable validation:
   ```typescript
   const requiredEnvVars = [
     'NEXT_PUBLIC_SUPABASE_URL',
     'NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY',
   ] as const;

   type EnvVar = (typeof requiredEnvVars)[number];

   function getEnvVar(name: EnvVar): string {
     const value = process.env[name];
     if (!value) {
       throw new Error(`Missing required environment variable: ${name}`);
     }
     return value;
   }

   export const env = {
     supabase: {
       url: getEnvVar('NEXT_PUBLIC_SUPABASE_URL'),
       publishableKey: getEnvVar('NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY'),
     },
   } as const;
   ```

3. Create `src/lib/supabase/server.ts` -- Server-side Supabase client:
   Uses `createServerClient` from `@supabase/ssr` with cookie handling from `next/headers`. Follow the exact pattern from RESEARCH.md Pattern 3. Use `process.env` directly (not env.ts -- env.ts uses eager evaluation which breaks in some server contexts).

4. Create `src/lib/supabase/client.ts` -- Browser Supabase client:
   Uses `createBrowserClient` from `@supabase/ssr`. Follow RESEARCH.md Pattern 3.

5. Create `src/lib/supabase/middleware.ts` -- Supabase middleware helper:
   Export an `updateSession` function that creates a Supabase server client in middleware context, refreshes the auth session via `supabase.auth.getUser()`, and returns the response with updated cookies. Follow RESEARCH.md middleware pattern.

6. Create `src/components/providers/theme-provider.tsx`:
   ```typescript
   "use client";
   import { ThemeProvider as NextThemesProvider, type ThemeProviderProps } from "next-themes";

   export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
     return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
   }
   ```

7. Replace `src/app/globals.css` with the full cinematic dark-first theme from RESEARCH.md Pattern 2. This includes:
   - `@import "tailwindcss"` and `@import "tw-animate-css"`
   - `@custom-variant dark (&:is(.dark *))` for Tailwind v4 dark mode
   - `.dark` class with all shadcn/ui CSS variables using oklch colors:
     - `--background: oklch(0.08 0 0)` (deep cinema black)
     - `--primary: oklch(0.88 0.18 90)` (cinematic yellow)
     - Full set of card, popover, secondary, muted, accent, destructive, border, input, ring variables
   - `:root` fallback with same values (shadcn expects it)
   - `@theme inline` block mapping CSS variables to Tailwind tokens
   - `@theme` block for brand-specific tokens (brand-yellow, brand-yellow-light, brand-yellow-dark, cinema-black, cinema-dark, cinema-surface, cinema-border, cinema-muted)
   - `@layer base` with border/outline defaults and body background/text

8. Update `src/app/layout.tsx` with root layout from RESEARCH.md code example:
   - Import globals.css, ThemeProvider
   - Export metadata with applicationName "MicroShort", appleWebApp config, formatDetection
   - Export viewport with themeColor "#141414", device-width, viewportFit "cover"
   - Render `<html lang="en" dir="ltr" suppressHydrationWarning>` (suppressHydrationWarning is CRITICAL for next-themes)
   - Wrap children in ThemeProvider with `attribute="class"`, `defaultTheme="dark"`, `enableSystem={false}`, `disableTransitionOnChange`
   - Body classes: `min-h-screen bg-background text-foreground antialiased`
   - Do NOT add SerwistProvider yet -- that comes in Plan 01-03

9. Verify: `pnpm build` still succeeds. Run `pnpm dlx @biomejs/biome check src/` to confirm Biome passes.
  </action>
  <verify>
    `pnpm build` succeeds. `pnpm dlx @biomejs/biome check src/` runs without blocking errors. `grep "oklch(0.88 0.18 90)" src/app/globals.css` confirms cinematic yellow is defined. `grep "createClient" src/lib/supabase/server.ts` confirms Supabase server client exists.
  </verify>
  <done>Supabase server/browser/middleware clients exist and export createClient/updateSession. Environment validation is set up. globals.css contains the full cinematic dark theme with oklch colors. Root layout uses ThemeProvider with forced dark mode. Build passes.</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes successfully
2. `pnpm dev` starts the dev server (verify manually that it loads)
3. `grep -r "oklch(0.88 0.18 90)" src/app/globals.css` returns the cinematic yellow definition
4. `grep "createServerClient" src/lib/supabase/server.ts` confirms server client setup
5. `grep "createBrowserClient" src/lib/supabase/client.ts` confirms browser client setup
6. `grep "suppressHydrationWarning" src/app/layout.tsx` confirms hydration fix
7. `pnpm dlx @biomejs/biome check src/` passes
</verification>

<success_criteria>
- The project builds without errors using `pnpm build`
- Cinematic dark theme variables are defined in globals.css with oklch colors
- Supabase client files exist for server, browser, and middleware contexts
- Root layout uses ThemeProvider with forced dark mode and suppressHydrationWarning
- Biome is configured and passes on all source files
- next.config.ts wraps with Serwist Turbopack (preparing for Plan 01-03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-app-shell/01-01-SUMMARY.md`
</output>
