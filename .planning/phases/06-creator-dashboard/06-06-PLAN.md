---
phase: 06-creator-dashboard
plan: 06
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/modules/creator/queries/get-creator-profile.ts
  - src/modules/creator/actions/follow.ts
  - src/modules/creator/actions/profile.ts
  - src/app/(public)/creator/[username]/page.tsx
  - src/app/(creator)/dashboard/settings/page.tsx
  - src/components/profile/public-profile.tsx
  - src/components/profile/follow-button.tsx
autonomous: true

must_haves:
  truths:
    - "A creator has a public profile page showing bio, series, follower count, and social links"
    - "Users can follow and unfollow a creator"
    - "Creator can edit their profile settings (display name, bio, social links, avatar)"
    - "Follower count updates automatically when users follow/unfollow"
  artifacts:
    - path: "src/app/(public)/creator/[username]/page.tsx"
      provides: "Public creator profile page"
    - path: "src/modules/creator/queries/get-creator-profile.ts"
      provides: "Query for public creator profile with series"
      exports: ["getCreatorProfile"]
    - path: "src/components/profile/follow-button.tsx"
      provides: "Follow/unfollow toggle button"
      exports: ["FollowButton"]
    - path: "src/app/(creator)/dashboard/settings/page.tsx"
      provides: "Creator profile settings page"
  key_links:
    - from: "src/app/(public)/creator/[username]/page.tsx"
      to: "src/modules/creator/queries/get-creator-profile.ts"
      via: "Server component data fetch"
      pattern: "getCreatorProfile"
    - from: "src/components/profile/follow-button.tsx"
      to: "src/modules/creator/actions/follow.ts"
      via: "Server action call"
      pattern: "(followCreator|unfollowCreator)"
    - from: "src/modules/creator/actions/follow.ts"
      to: "supabase:followers"
      via: "Supabase insert/delete"
      pattern: "supabase.*from.*followers"
---

<objective>
Build the public creator profile page (bio, series catalog, follower count, social links) with follow/unfollow functionality, and the creator profile settings page for editing bio, social links, and display name.

Purpose: Public profiles give creators a presence on the platform and let viewers discover and follow their favorite creators.
Output: Public profile page, follow/unfollow actions, profile settings form.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-creator-dashboard/06-RESEARCH.md
@.planning/phases/06-creator-dashboard/06-01-SUMMARY.md
@src/db/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Public creator profile page with follow functionality</name>
  <files>
    src/modules/creator/queries/get-creator-profile.ts
    src/modules/creator/actions/follow.ts
    src/app/(public)/creator/[username]/page.tsx
    src/components/profile/public-profile.tsx
    src/components/profile/follow-button.tsx
  </files>
  <action>
    1. **src/modules/creator/queries/get-creator-profile.ts:**
       - Wrap with React.cache (established pattern)
       - `getCreatorProfile(username: string)`:
         - Query profiles where username matches AND role='creator', select: id, username, display_name, avatar_url, bio, social_links, follower_count, role
         - If not found, return null
         - Query series where creator_id matches AND status='published', with nested seasons(id, season_number, title, episodes(id)), ordered by created_at desc
         - Return profile + series array
       - `isFollowing(userId: string, creatorId: string)`:
         - Check if a row exists in followers where follower_id=userId and creator_id=creatorId
         - Return boolean

    2. **src/modules/creator/actions/follow.ts** ("use server"):
       - `followCreator(creatorId: string)`:
         - Auth check, get user.id
         - Insert into followers: follower_id=user.id, creator_id
         - On conflict (already following): do nothing
         - RevalidatePath for the creator's profile page
       - `unfollowCreator(creatorId: string)`:
         - Auth check, get user.id
         - Delete from followers where follower_id=user.id and creator_id
         - RevalidatePath
       - Note: The follower_count on profiles is updated by the database trigger created in 06-01 migration. No application-level count update needed.

    3. **src/components/profile/follow-button.tsx** (client component):
       - Props: `creatorId: string`, `initialIsFollowing: boolean`, `isAuthenticated: boolean`
       - Optimistic UI: toggle state immediately, call server action
       - If not authenticated: redirect to `/login?next=/creator/{username}` on click
       - Display: "Following" (outline button) or "Follow" (primary button)
       - Use `useTransition` for pending state

    4. **src/components/profile/public-profile.tsx** (client component):
       - Props: typed profile object with series array, isFollowing boolean, isAuthenticated boolean
       - Layout: Banner/header area with avatar (shadcn Avatar), display name, bio, follower count, follow button, social links as icon links
       - Social links: parse JSONB, display known platforms (Twitter/X, Instagram, YouTube, TikTok) with appropriate icons from lucide-react
       - Series grid below: reuse SeriesCard pattern from browse page (thumbnail, title, genre badge, episode count)
       - Each series card links to `/series/{slug}`
       - Empty state if no published series: "No published series yet"

    5. **src/app/(public)/creator/[username]/page.tsx:**
       - Server component with `generateMetadata` for SEO (title: "{name} on MicroShort", description: bio)
       - Fetch creator profile via getCreatorProfile(params.username)
       - If not found, return `notFound()`
       - Check if current user is following (if authenticated)
       - Render PublicProfile component with all data
       - This page is in the `(public)` route group so it has the Header+Footer layout
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `/creator/{username}` renders creator profile with bio, series, and follower count
    - Follow/unfollow toggles work with optimistic UI
    - SEO metadata generated for creator profiles
    - 404 returned for non-existent or non-creator usernames
  </verify>
  <done>Public creator profile page shows bio, published series, follower count, and social links. Follow/unfollow works with optimistic UI and database trigger maintains accurate follower count.</done>
</task>

<task type="auto">
  <name>Task 2: Creator profile settings page</name>
  <files>
    src/modules/creator/actions/profile.ts
    src/app/(creator)/dashboard/settings/page.tsx
  </files>
  <action>
    1. **src/modules/creator/actions/profile.ts** ("use server"):
       - `updateProfile(prevState: CreatorFormState, formData: FormData)`:
         - Auth check
         - Parse formData: displayName (2-50 chars), bio (optional, max 500), socialLinks (optional, JSON string of `{platform: url}` pairs), username (optional, 3-30 chars, alphanumeric+dashes)
         - Validate with Zod schema (create a profileSchema in this file or add to validations/creator.ts)
         - If username changed, check uniqueness in profiles table
         - Update profiles table: display_name, bio, social_links (parse JSON), username
         - RevalidatePath for both /dashboard/settings and /creator/{username}
         - Return success/error

    2. **src/app/(creator)/dashboard/settings/page.tsx:**
       - Server component: auth check, fetch current user's profile
       - Render a settings form (client component inline or separate):
         - Display Name input (pre-filled)
         - Username input (pre-filled, with note about URL: "Your profile URL: microshort.com/creator/{username}")
         - Bio textarea (pre-filled)
         - Social Links: editable fields for Twitter/X, Instagram, YouTube, TikTok URLs
           - Render as 4 labeled inputs, pre-filled from social_links JSONB
           - On submit, collect into `{twitter: url, instagram: url, ...}` JSON string
         - Avatar: display current avatar_url with a note that avatar upload is managed through account settings (or add simple file upload similar to ThumbnailUpload if straightforward)
         - Submit button with useActionState + isPending
         - Success/error toast feedback via sonner
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Settings page pre-fills current profile data
    - Profile update validates and persists to database
    - Username uniqueness checked before update
    - Social links stored as structured JSONB
  </verify>
  <done>Creator can edit their display name, username, bio, and social links from the settings page. Changes reflect on the public profile page immediately after revalidation.</done>
</task>

</tasks>

<verification>
- `/creator/{username}` shows creator profile with bio, series grid, follower count, social links
- FollowButton toggles with optimistic UI and server-side persistence
- Follower count maintained by database trigger (not application code)
- `/dashboard/settings` shows pre-filled profile form
- Profile updates revalidate both dashboard and public profile pages
- SEO metadata generated for creator profile pages
- `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Creator has a shareable public profile URL at /creator/{username}
- Follower count is accurate and maintained by DB trigger
- Follow/unfollow works for authenticated users with optimistic UI
- Social links display as clickable platform icons
- Profile settings allow editing all public-facing fields
- Published series display on the profile page for discovery
</success_criteria>

<output>
After completion, create `.planning/phases/06-creator-dashboard/06-06-SUMMARY.md`
</output>
