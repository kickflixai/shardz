---
phase: 06-creator-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["06-01", "06-02"]
files_modified:
  - src/modules/creator/actions/series.ts
  - src/modules/creator/actions/seasons.ts
  - src/modules/creator/actions/episodes.ts
  - src/modules/creator/queries/get-creator-series.ts
  - src/app/(creator)/dashboard/series/page.tsx
  - src/app/(creator)/dashboard/series/new/page.tsx
  - src/app/(creator)/dashboard/series/[seriesId]/page.tsx
  - src/app/(creator)/dashboard/series/[seriesId]/seasons/new/page.tsx
  - src/app/(creator)/dashboard/series/[seriesId]/seasons/[seasonId]/page.tsx
  - src/components/creator/series-form.tsx
  - src/components/creator/season-form.tsx
  - src/components/creator/episode-list-manager.tsx
autonomous: true

must_haves:
  truths:
    - "Creator can create a new series with title, description, genre, and thumbnail"
    - "Creator can create seasons with pricing and release strategy"
    - "Creator can view, edit, and delete their series catalog"
    - "Creator can reorder episodes within a season via sort_order"
    - "Creator can set per-season pricing by selecting a price tier"
  artifacts:
    - path: "src/modules/creator/actions/series.ts"
      provides: "Server Actions for series CRUD"
      exports: ["createSeries", "updateSeries", "deleteSeries"]
    - path: "src/modules/creator/actions/seasons.ts"
      provides: "Server Actions for season CRUD"
      exports: ["createSeason", "updateSeason", "deleteSeason"]
    - path: "src/modules/creator/actions/episodes.ts"
      provides: "Server Actions for episode CRUD and reorder"
      exports: ["createEpisode", "updateEpisode", "deleteEpisode", "reorderEpisodes"]
    - path: "src/app/(creator)/dashboard/series/page.tsx"
      provides: "Series list page showing creator's catalog"
    - path: "src/components/creator/episode-list-manager.tsx"
      provides: "Reorderable episode list with status indicators"
  key_links:
    - from: "src/app/(creator)/dashboard/series/new/page.tsx"
      to: "src/modules/creator/actions/series.ts"
      via: "useActionState form binding"
      pattern: "useActionState.*createSeries"
    - from: "src/components/creator/episode-list-manager.tsx"
      to: "src/modules/creator/actions/episodes.ts"
      via: "reorderEpisodes server action"
      pattern: "reorderEpisodes"
    - from: "src/modules/creator/actions/series.ts"
      to: "supabase:series"
      via: "Supabase CRUD"
      pattern: "supabase.*from.*series"
---

<objective>
Build the complete series/season/episode management system: Server Actions for all CRUD operations, series catalog list, create/edit forms for series and seasons, episode list manager with reordering, pricing via price tier selection, and release strategy configuration.

Purpose: This is the creator's content management hub -- the ability to organize, price, and configure their series catalog.
Output: Full CRUD server actions, catalog pages, and management UI for series, seasons, and episodes.
</objective>

<execution_context>
@/Users/solofilms/.claude/get-shit-done/workflows/execute-plan.md
@/Users/solofilms/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-creator-dashboard/06-RESEARCH.md
@.planning/phases/06-creator-dashboard/06-01-SUMMARY.md
@.planning/phases/06-creator-dashboard/06-02-SUMMARY.md
@src/lib/validations/creator.ts
@src/modules/creator/actions/apply.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Server Actions for series, season, and episode CRUD</name>
  <files>
    src/modules/creator/actions/series.ts
    src/modules/creator/actions/seasons.ts
    src/modules/creator/actions/episodes.ts
    src/modules/creator/queries/get-creator-series.ts
  </files>
  <action>
    All server actions follow the established pattern from auth forms and the research examples: "use server", Zod v4 validation, CreatorFormState return type, auth + role check, revalidatePath after mutations.

    1. **src/modules/creator/actions/series.ts:**
       - `createSeries(prevState, formData)`: Auth check, verify role is creator/admin, parse with seriesSchema, generate slug as `{kebab-title}-{4-char-random-hex}` (Pitfall 4: slug uniqueness), insert with creator_id, status "draft". On success, revalidatePath and redirect to `/dashboard/series/{id}`.
       - `updateSeries(seriesId, prevState, formData)`: Auth + ownership check (series.creator_id === user.id), parse with seriesSchema partial, update. RevalidatePath.
       - `deleteSeries(seriesId)`: Auth + ownership check, delete (cascade will handle seasons/episodes). RevalidatePath. Return success/error.
       - Use `bind` for seriesId parameter in update/delete (standard Next.js pattern for passing extra args to server actions).

    2. **src/modules/creator/actions/seasons.ts:**
       - `createSeason(seriesId, prevState, formData)`: Auth + series ownership check, parse with seasonSchema, compute next season_number from existing count + 1, set sort_order = season_number, insert. Redirect to season management page.
       - `updateSeason(seasonId, prevState, formData)`: Auth + ownership chain check (season -> series -> creator_id), parse, update. Include price_tier_id and release_strategy. If release_strategy is "drip", also save drip_interval_days from formData. RevalidatePath.
       - `deleteSeason(seasonId)`: Auth + ownership check, delete (cascade episodes). RevalidatePath.

    3. **src/modules/creator/actions/episodes.ts:**
       - `createEpisode(seasonId, prevState, formData)`: Auth + ownership chain check, parse with episodeSchema, compute next episode_number and sort_order, insert with status "draft". Return the created episode ID in the success response (needed by upload form).
       - `updateEpisode(episodeId, prevState, formData)`: Auth + ownership chain, parse, update metadata fields (title, description, content_warnings, thumbnail_url). RevalidatePath.
       - `deleteEpisode(episodeId)`: Auth + ownership, delete. If episode has mux_asset_id, call `mux.video.assets.delete(mux_asset_id)` to clean up Mux storage. RevalidatePath.
       - `reorderEpisodes(seasonId, orderedIds: string[])`: Auth + ownership. For each ID at index i, update sort_order = i. Use a batch update approach (no episode_number mutation -- Pitfall 5). RevalidatePath.

    4. **src/modules/creator/queries/get-creator-series.ts:**
       - `getCreatorSeries(creatorId)`: Select all series where creator_id matches, with nested seasons (count, pricing) and episode counts. Order by created_at desc. Use React.cache wrapper.
       - Return type: array of series with season_count, episode_count, and status.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All server actions have "use server" directive
    - All mutations check auth + ownership before proceeding
    - Slug generation includes random suffix for uniqueness
    - Reorder updates sort_order, not episode_number
  </verify>
  <done>All CRUD server actions for series, seasons, and episodes are complete with auth, ownership checks, Zod validation, and proper cache revalidation. Episode reorder uses sort_order to avoid unique constraint issues.</done>
</task>

<task type="auto">
  <name>Task 2: Series catalog pages and management UI</name>
  <files>
    src/app/(creator)/dashboard/series/page.tsx
    src/app/(creator)/dashboard/series/new/page.tsx
    src/app/(creator)/dashboard/series/[seriesId]/page.tsx
    src/app/(creator)/dashboard/series/[seriesId]/seasons/new/page.tsx
    src/app/(creator)/dashboard/series/[seriesId]/seasons/[seasonId]/page.tsx
    src/components/creator/series-form.tsx
    src/components/creator/season-form.tsx
    src/components/creator/episode-list-manager.tsx
  </files>
  <action>
    1. **Series list page** (`/dashboard/series/page.tsx`):
       - Server component: auth check, fetch creator's series via getCreatorSeries
       - Display as cards in a grid: thumbnail, title, genre badge, status badge (draft/published), season count, episode count
       - "Create New Series" button linking to /dashboard/series/new
       - Each card links to /dashboard/series/{id} for editing
       - Empty state if no series

    2. **Create series page** (`/dashboard/series/new/page.tsx`):
       - Server component wrapper with auth + role check
       - Renders SeriesForm in create mode

    3. **SeriesForm** component (`src/components/creator/series-form.tsx`):
       - Client component with useActionState
       - Props: `mode: "create" | "edit"`, `initialData?: Partial<Series>`
       - Fields: title (Input), description (Textarea), genre (Select dropdown from GENRE_CONFIG), thumbnail (ThumbnailUpload component from 06-02)
       - Hidden input for thumbnail_url (set by ThumbnailUpload callback)
       - Submit button with isPending loading state
       - FieldError display for validation errors

    4. **Series detail/edit page** (`/dashboard/series/[seriesId]/page.tsx`):
       - Server component: auth + ownership check, fetch series with seasons
       - SeriesForm in edit mode at top
       - Below: seasons list with "Add Season" button
       - Each season card: title (or "Season {n}"), price tier, release strategy, episode count, status badge, link to season management

    5. **Create season page** (`/dashboard/series/[seriesId]/seasons/new/page.tsx`):
       - Server component: auth + ownership check
       - Renders SeasonForm in create mode

    6. **SeasonForm** component (`src/components/creator/season-form.tsx`):
       - Client component with useActionState
       - Fields: title (optional), description (optional), priceTierId (Select from price_tiers table query), releaseStrategy (radio: "All at once" / "Drip release"), dripIntervalDays (number input, shown only when drip selected, default 7, range 1-30)
       - Submit with isPending state

    7. **Season management page** (`/dashboard/series/[seriesId]/seasons/[seasonId]/page.tsx`):
       - Server component: auth + ownership chain check, fetch season with episodes
       - SeasonForm in edit mode at top
       - Below: EpisodeListManager component
       - "Upload New Episode" button linking to episodes/new (already built in 06-02)

    8. **EpisodeListManager** (`src/components/creator/episode-list-manager.tsx`):
       - Client component showing ordered list of episodes
       - Each row: episode number, title, status badge (draft/processing/ready/published), duration, thumbnail preview, edit/delete actions
       - Drag handle or up/down arrow buttons for reorder (use a simple move-up/move-down approach, no complex DnD library)
       - On reorder: call reorderEpisodes server action with new ordered IDs
       - Edit button links to episode edit page (future -- show inline or modal)
       - Delete button with confirmation dialog
       - Status badge colors: draft=gray, processing=yellow, ready=green, published=blue

    **Pitfall 8 awareness:** When displaying publish actions, show warning if episode count < 8 or > 70 (the DB trigger enforces this).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `/dashboard/series` shows creator's series list
    - Series and season forms use useActionState pattern
    - Episode list manager supports reorder via sort_order
    - All pages check auth and ownership
  </verify>
  <done>Complete series management UI: series catalog list, create/edit series with thumbnail, season management with pricing and release strategy, and episode list with reorder, status badges, and CRUD actions.</done>
</task>

</tasks>

<verification>
- `/dashboard/series` lists creator's series with counts and status
- `/dashboard/series/new` creates a new series with slug generation
- `/dashboard/series/[id]` shows edit form and season list
- `/dashboard/series/[id]/seasons/new` creates seasons with pricing
- `/dashboard/series/[id]/seasons/[id]` manages season and shows episode list
- Episode reorder updates sort_order without touching episode_number
- All server actions validate with Zod and check auth+ownership
- `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Creator can perform full CRUD on series, seasons, and episodes
- Series slugs are unique via random suffix
- Season pricing is set via price tier selection
- Release strategy (all at once / drip) is configurable per season
- Episode reorder uses sort_order to avoid unique constraint violations
- All management pages are accessible from sidebar navigation
</success_criteria>

<output>
After completion, create `.planning/phases/06-creator-dashboard/06-03-SUMMARY.md`
</output>
